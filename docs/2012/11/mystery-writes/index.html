<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><meta content="default-src 'self' stats.zehta.me; img-src 'self' licensebuttons.net www.gravatar.com" http-equiv="Content-Security-Policy"/><title>Mystery Writes - Timid Robot</title><meta content="Timid Robot Zehta" name="author"/><link href="/static/normalize.css" rel="stylesheet"/><link href="/static/skeleton.css" rel="stylesheet"/><link href="/static/fa/css/fontawesome.css" rel="stylesheet"/><link href="/static/fa/css/brands.css" rel="stylesheet"/><link href="/static/fa/css/solid.css" rel="stylesheet"/><link href="/static/pygments-monokai.css" rel="stylesheet"/><link href="/static/custom.css" rel="stylesheet"/><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/><link href="/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png"/><meta content="Timid Robot's website" property="og:site_name"/><meta content="https://zehta.me/" property="og:url"/><meta content="Blog" property="og:title"/><meta content="website" property="og:type"/><meta content="https://zehta.me/favicon-590x310.png" property="og:image"/><meta content="590" property="og:image:width"/><meta content="310" property="og:image:height"/><meta content="image/png" property="og:image:type"/><meta content="logo" property="og:image:alt"/><script async="" data-domain="zehta.me" defer="" src="https://stats.zehta.me/js/plausible.outbound-links.js"></script><script async="" defer="" integrity="sha384-pgIDlHOsV/3+TBW/dJ9Se+XEBP30T0a9Z/8vWxDLwYSvrMdLhZb60Pqbvd/UxLJT" src="/static/custom_events.js"></script></head><body><nav class="container"><div class="row"><div class="three columns title"><a href="/">Timid Robot</a></div><div class="nine columns navi"><div class="navgroup"><div class="linkinactive"><a class="linkinactive" href="/about/"><i class="fas fa-address-card"></i> About</a></div><div class="linkinactive"><a class="linkinactive" href="/resume/"><i class="fas fa-laptop-code"></i> Résumé</a></div></div><div class="navgroup"><div class="linkinactive"><a class="linkinactive" href="/tags/"><i class="fas fa-tags"></i> Tags</a></div><div class="linkactive"><a class="linkactive" href="/"><i class="fas fa-newspaper"></i> Blog</a></div></div></div></div></nav><main class="container page"><div class="row"><div class="blog-post"><h1>Mystery Writes</h1><div class="meta">2012 Nov 01, Timid Robot Zehta</div><p>We recently observed constant write activity on our development server, while watching dstat. With the help of <code>iotop</code> (<a href="http://guichaz.free.fr/iotop/">iotop</a>), we identified the Apache web server was the culprit.</p><p>But why would apache be doing so many writes? That's not normal behaviori (excluding the the logs). We then used auditd to log writes by apache:</p><div class="hll"><pre><span></span>sudo auditctl -a exit,always -S write -F <span class="nv">uid</span><span class="o">=</span><span class="m">33</span>
</pre></div><p>We also logged opens that were not O_RDONLY:</p><div class="hll"><pre><span></span>sudo auditctl -a exit,always -S open -F <span class="nv">uid</span><span class="o">=</span><span class="m">33</span> -F a1<span class="s1">'!=0'</span><span class="sb">`</span>
</pre></div><p>This resulted in the following rules:</p><div class="hll"><pre><span></span>sudo auditctl -l LIST_RULES: exit,always <span class="nv">uid</span><span class="o">=</span><span class="m">33</span> <span class="o">(</span>0x21<span class="o">)</span> <span class="nv">syscall</span><span class="o">=</span>write LIST_RULES: exit,always <span class="nv">uid</span><span class="o">=</span><span class="m">33</span> <span class="o">(</span>0x21<span class="o">)</span> a1!<span class="o">=</span><span class="m">0</span> <span class="nv">syscall</span><span class="o">=</span>open
</pre></div><p>This allowed us to isolate a PHP module that was completely broken (using <code>aureport</code>).</p><h2 id="man-pages">Man Pages</h2><ul><li><a href="http://manpages.ubuntu.com/manpages/focal/en/man8/auditctl.8.html">man 8 auditctl</a> - a utility to assist controlling the kernel's audit system</li><li><a href="http://manpages.ubuntu.com/manpages/focal/en/man8/aureport.8.html">man 8 aureport</a> - a tool that produces summary reports of audit daemon logs</li><li><a href="http://manpages.ubuntu.com/manpages/focal/en/man8/aureport.8.html">man 1 dstat</a> - versatile tool for generating system resource statistics</li><li><a href="http://manpages.ubuntu.com/manpages/focal/en/man8/iotop.8.html">man 1 iotop</a> - simple top-like I/O monitor</li><li><a href="http://manpages.ubuntu.com/manpages/focal/man2/open.2.html">man 2 open</a> - open and possibly create a file or device</li></ul><div><h2>Tags</h2><ul><li><a href="/tags/2012//"><i class="fas fa-tag"></i> 2012</a></li><li><a href="/tags/sysadmin//"><i class="fas fa-tag"></i> Systems Administration</a></li><li><a href="/tags/linux//"><i class="fas fa-tag"></i> Linux</a></li><li><a href="/tags/troubleshooting//"><i class="fas fa-tag"></i> Troubleshooting</a></li></ul></div></div><hr class="copyright"/><p class="copyright"><a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license" title="CC BY-SA 4.0 (license button)"><img alt="CC BY-SA 4.0 license button" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"/></a> Copyright © 2012 Timid Robot Zehta. This work is licensed under a <strong><a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="license" title="Creative Commons Attribution-ShareAlike 4.0 International License">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</strong></p></div></main><nav class="container footer"><div class="post-prev"><a href="/2013/01/go-to-bed/" title="Previous post: Go to Bed"><i class="fas fa-angle-left"></i> Go to Bed</a></div><div class="post-next"><a href="/2012/10/automation-of-nets/" title="Next post: The Automation of Networks of Networks">The Automation of Networks ... <i class="fas fa-angle-right"></i></a></div></nav><div class="container bottombot"><i class="fas fa-robot"></i></div></body></html>