<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Mystery Writes - Timid Robot</title>
  <meta name="author" content="Timid Robot Zehta">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../../static/normalize.css">
  <link rel="stylesheet" href="../../../static/skeleton.css">
  <link rel="stylesheet" href="../../../static/custom.css">
</head>
<body>
  <nav class="container">
    <div class="row">
      <div class="two columns navi active">
        <a class="active" href="../../../">Blog</a>
      </div>
      <div class="two columns navi ">
        <a class="" href="../../../tags/">Tags</a>
      </div>
      <div class="two columns navi ">
        <a class="" href="../../../resume/">Résumé</a>
      </div>
      <div class="two columns navi ">
        <a class="" href="../../../about/">About</a>
      </div>
      <div class="four columns title">
        <h1>Timid Robot</h1>
      </div>
    </div>
  </nav>
  <div class="container page">
    <div class="row">

  <div class="blog-post">
  <h2>Mystery Writes</h2>
  <p class="meta">
    2012-11-01, Thursday, Timid Robot Zehta
  </p>
  <p>We recently observed constant write activity on our development server, while
watching dstat. With the help of <code>iotop</code> (<a href="http://guichaz.free.fr/iotop/">iotop</a>), we identified the
Apache web server was the culprit.</p>
<p>But why would apache be doing so many writes? That's not normal behaviori
(excluding the the logs). We then used auditd to log writes by apache:</p>
<pre><code class="lang-shell">sudo auditctl -a exit,always -S write -F uid=33
</code></pre>
<p>We also logged opens that were not O_RDONLY:</p>
<pre><code class="lang-shell">sudo auditctl -a exit,always -S open -F uid=33 -F a1&#39;!=0&#39;`
</code></pre>
<p>This resulted in the following rules:</p>
<pre><code class="lang-shell">sudo auditctl -l LIST_RULES: exit,always uid=33 (0x21) syscall=write LIST_RULES: exit,always uid=33 (0x21) a1!=0 syscall=open
</code></pre>
<p>This allowed us to isolate a PHP module that was completely broken (using
<code>aureport</code>).</p>
<h3 id="man-pages">Man Pages</h3><ul>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man8/auditctl.8.html">man 8 auditctl</a> - a utility to assist controlling the kernel's
audit system</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man8/aureport.8.html">man 8 aureport</a> - a tool that produces summary reports of
audit daemon logs</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man8/aureport.8.html">man 1 dstat</a> - versatile tool for generating system resource
statistics</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man1/iotop.1.html">man 1 iotop</a> - simple top-like I/O monitor</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/man2/open.2.html">man 2 open</a> - open and possibly create a file or device</li>
</ul>

  
  <div>
    <h3>Tags:</h3>
    <ul>
      <li><a href="/tags/linux/">Linux</a></li>
      <li><a href="/tags/systems-administration/">Systems Administration</a></li>
      <li><a href="/tags/troubleshooting/">Troubleshooting</a></li>
    </ul>
  </div>
  </div>
<hr class="copyright">
<p class="copyright">
  <a rel="license"
     href="https://creativecommons.org/licenses/by-sa/4.0/">
    <img alt="CC BY-SA 4.0 license button"
         src="https://licensebuttons.net/l/by-sa/4.0/88x31.png"></a>
  Copyright &copy; 2012 Timid Robot Zehta
  . This work is licensed under a <strong>
  <a rel="license"
     href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons
     Attribution-ShareAlike 4.0 International License</a>
  .</strong>
</p>
  <div class="pagination">
    <p class="prev">
    <a href="../../../2013/01/go-to-bed/">
      &#8672; Go to Bed</a>
    </p>
    <p class="next">
    <a href="../../../2012/10/automation-of-nets/">
      The Automation of Networks of Networks &#8674;</a>
    </p>
  </div>
    </div>
  </div>
</body>
</html>
