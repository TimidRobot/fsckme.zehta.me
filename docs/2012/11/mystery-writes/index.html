<!doctype html>
<meta charset="utf-8">
<link rel="stylesheet" href="../../../static/style.css">
<title>Mystery Writes â€” fsckme</title>
<body>
  <header>
    <h1>fsck me</h1>
    <nav>
      <ul class="nav navbar-nav">
        <li><a href="../../../">Home</a></li>
          <li><a href="../../../tags/">Tags</a></li>
          <li><a href="../../../about/">About</a></li>
      </ul>
    </nav>
  </header>
  <div class="page">
    
  <div class="blog-post">
    <h2>Mystery Writes</h2>
  <p class="meta">
    written by
      Timid Robot Zehta
    on 2012-11-01 13:28:00
  </p>
  <p>We recently observed constant write activity on our development server, while
watching dstat. With the help of <a href="http://guichaz.free.fr/iotop/"><code>iotop</code></a>, we identified the Apache web
server was the culprit. But why would apache be doing so many writes? That's
not normal behavior (excluding the the logs). We then used auditd to log
writes by apache.</p>
<pre><code class="lang-shell">sudo auditctl -a exit,always -S write -F uid=33
</code></pre>
<p>We also logged opens that were not O_RDONLY:</p>
<pre><code class="lang-shell">sudo auditctl -a exit,always -S open -F uid=33 -F a1&#39;!=0&#39;`
</code></pre>
<p>This resulted in the following rules:</p>
<pre><code class="lang-shell">sudo auditctl -l LIST_RULES: exit,always uid=33 (0x21) syscall=write LIST_RULES: exit,always uid=33 (0x21) a1!=0 syscall=open
</code></pre>
<p>This allowed us to isolate a PHP module that was completely broken (using
<code>aureport</code>).</p>
<h3>Man Pages</h3>
<ul>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man8/auditctl.8.html">man 8 auditctl</a> - a utility to assist controlling the kernel's
audit system</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man8/aureport.8.html">man 8 aureport</a> - a tool that produces summary reports of
audit daemon logs</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man8/aureport.8.html">man 1 dstat</a> - versatile tool for generating system resource
statistics</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/en/man1/iotop.1.html">man 1 iotop</a> - simple top-like I/O monitor</li>
<li><a href="http://manpages.ubuntu.com/manpages/lucid/man2/open.2.html">man 2 open</a> - open and possibly create a file or device</li>
</ul>

  <div>
    <h3>Tags:</h3>
    <ul>
    <li><a href="/tags/systems-administration/">Systems-Administration</a></li>
    <li><a href="/tags/linux/">Linux</a></li>
    <li><a href="/tags/troubleshooting/">Troubleshooting</a></li>
    </ul>
  </div>
  </div>
  </div>
  <footer>
    <small>
      <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="CC BY-SA 4.0 license button" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png" />
        </a></p>
      <p>All the content on this website is licensed under a <strong>
        <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
        Creative Commons Attribution-ShareAlike 4.0 International License</a>
        </strong> unless otherwise specified.</p>
    </small>
  </footer>
</body>
